# Obsidian Plugin Development Universal Guidelines

このガイドラインは、ごりゅごさんとAI（Antigravity）がObsidianプラグインを共同開発する際の「共通認識」と「ベストプラクティス」をまとめたものです。
今後の開発では、常にこのドキュメントを参照し、同じ失敗を繰り返さないようにします。

## 1. コミュニケーションとスタイル
*   **文体**: 読みやすく、知的で誠実な「教科書的なスタイル」を心がける。「〜じゃん」「〜だよ」といった口語や、大げさなセールストークは避ける。太字の乱用も厳禁。
*   **日本語ドキュメント**: `README.md` (英語) と対になる `README_JA.md` (日本語) を最初から用意する。プラグインとしての機能説明は、宣伝色を排し、機能とメリットを端的に伝える。
*   **確認優先**: 大きな機能追加や仕様変更（アイコンの変更、UIの配置変更など）を行う際は、実装前に必ずユーザーに方針を確認する。

## 2. プロジェクト構成と命名規則
*   **フォルダ構成**:
    *   開発フォルダ（リポジトリ）と、実際のObsidianプラグインフォルダ（`.obsidian/plugins/...`）は別物であることを意識する。
    *   **重要**: プラグインID（`manifest.json` の `id`）を変更した場合、テスト環境のフォルダ名も手動で変更する必要がある場合がある。これが不一致だと「プラグインが認識されない」「古いコードが動いている」という事故につながる。
*   **命名規則**:
    *   クラス名、変数名は `manifest.json` の `id` や `name` と一貫性を持たせる（例: `id: atomic-insights` なら `AtomicInsightsView`, `AtomicInsightsPlugin`）。
    *   古いプロジェクト名が残らないように、Rename時は `grep` で徹底的に洗い出す。

## 3. 実装のベストプラクティス (Technical Pitfalls)

### UI/UX
*   **ネイティブ感**: Obsidianの標準UI（フォント、色、アイコンサイズ、余白）に合わせる。CSS変数（`--background-secondary`など）を積極的に使用する。
*   **アイコン**:
    *   独自のSVGアイコンを使う場合、複雑な外部ライブラリを使わず、コード内にSVG定義を埋め込むのが最も軽量で管理しやすい。
    *   状態遷移（ON/OFF）があるアイコンは、**形状**を明確に変える（例：`folder` vs `folder-tree`）。色だけの変化はテーマによって視認性が悪いため避ける。
    *   アクティブ状態には `.is-active` クラスを付与し、`--interactive-accent` と `--text-on-accent` を使用して明確に強調する。

### イベントハンドリング
*   **初期読み込み問題**:
    *   `app.workspace.onLayoutReady` だけでは不十分な場合がある（特に起動直後）。
    *   **対策**: `active-leaf-change` イベントも監視し、フォーカスが移ったタイミングでも更新処理を走らせることで、確実に初期データをロードさせる。
*   **Hover Preview**:
    *   `mouseover` イベントで `app.workspace.trigger('hover-link', ...)` を呼ぶのが標準手法。
    *   **注意**: 無関係な `title` 属性（ツールチップ）が要素に設定されていると、Obsidianのプレビューと競合して表示がおかしくなることがある。ホバープレビューを使う要素には `title` を設定しない、または競合しないように注意する。

### 設定ファイル
*   `.gitignore` には必ず `node_modules`, `main.js`, `manifest.json`, `styles.css` **以外** のビルド成果物を含める（ただし、リリースコミット用に `main.js` 等を含める運用ルールにしている場合はそれに従う）。今の運用では `main.js` もリポジトリ管理している。

## 4. リリースフロー
1.  **機能実装**: フェーズごとにタスクを完了させる。
2.  **検証**: ローカルのObsidian環境に `cp` コマンド等でファイルをコピーし、実機確認。
3.  **バージョン更新**: `manifest.json` と `package.json` の両方を更新。
4.  **ビルド & コミット**: `npm run build` をしてから、変更全てを含めてGitコミット。

---
**更新履歴**
- 2026-01-13: 初版作成 (v0.2.0 リリース時)

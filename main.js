/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

class AdamicAdar {
    constructor(app, settings) {
        this.app = app;
        this.settings = settings;
    }
    calculate(sourcePath) {
        const { resolvedLinks } = this.app.metadataCache;
        // 1. Build Graph & Filtering
        const exclusionList = this.settings.excludedFolders
            .split('\n')
            .map(s => s.trim())
            .filter(s => s.length > 0);
        const isExcluded = (path) => {
            return exclusionList.some(folder => path.startsWith(folder));
        };
        if (isExcluded(sourcePath)) ;
        const neighbors = {};
        const degrees = {};
        // Helper to add edge
        const addEdge = (u, v) => {
            if (!neighbors[u])
                neighbors[u] = new Set();
            if (!neighbors[v])
                neighbors[v] = new Set();
            neighbors[u].add(v);
            neighbors[v].add(u);
        };
        // Populate Graph
        // We only care about resolved links for now as unresolved files don't have back-links easily tracked without full scan
        // iterating source files
        for (const source in resolvedLinks) {
            if (isExcluded(source))
                continue;
            const targets = resolvedLinks[source];
            for (const target in targets) {
                if (isExcluded(target))
                    continue;
                addEdge(source, target);
            }
        }
        // Calculate degrees
        for (const node in neighbors) {
            degrees[node] = neighbors[node].size;
        }
        // 2. Algorithm
        const sourceNeighbors = neighbors[sourcePath];
        if (!sourceNeighbors)
            return [];
        const results = [];
        for (const targetNode in neighbors) {
            if (targetNode === sourcePath)
                continue;
            const targetNeighbors = neighbors[targetNode];
            let score = 0;
            const commonNodes = [];
            // Intersection
            sourceNeighbors.forEach(w => {
                if (targetNeighbors.has(w)) {
                    commonNodes.push(w);
                    const degree = degrees[w];
                    if (degree > 1) { // log(1) is 0, avoid division by zero if degree is 1 (though logic implies at least 2 if it connects two nodes)
                        score += 1 / Math.log(degree);
                    }
                }
            });
            if (score > 0) {
                results.push({
                    path: targetNode,
                    score: score,
                    commonNeighbors: commonNodes
                });
            }
        }
        // 3. Sort
        return results.sort((a, b) => b.score - a.score);
    }
}

const VIEW_TYPE_ATOMIC_INSIGHTS = 'atomic-insights-view';
class AtomicInsightsView extends obsidian.ItemView {
    constructor(leaf, plugin) {
        super(leaf);
        this.currentFilePath = null;
        this.plugin = plugin;
        this.adamicAdar = new AdamicAdar(plugin.app, plugin.settings);
    }
    getViewType() {
        return VIEW_TYPE_ATOMIC_INSIGHTS;
    }
    getDisplayText() {
        return 'Atomic Insights';
    }
    getIcon() {
        return 'atomic-insights';
    }
    onOpen() {
        return __awaiter(this, void 0, void 0, function* () {
            this.update();
            // Register event for file switch
            this.registerEvent(this.app.workspace.on('file-open', (file) => {
                if (file) {
                    this.update(file.path);
                }
            }));
            // Also listen to active-leaf-change to catch initial load or focus changes
            this.registerEvent(this.app.workspace.on('active-leaf-change', () => {
                this.update();
            }));
        });
    }
    update(filePath) {
        return __awaiter(this, void 0, void 0, function* () {
            // Wait for layout to be ready to ensure active file can be retrieved
            if (!this.app.workspace.layoutReady) {
                this.app.workspace.onLayoutReady(() => this.update(filePath));
                return;
            }
            if (!filePath) {
                const activeFile = this.app.workspace.getActiveFile();
                if (activeFile) {
                    filePath = activeFile.path;
                }
                else {
                    this.renderEmpty();
                    return;
                }
            }
            this.currentFilePath = filePath;
            // Pass fresh settings in case they changed
            this.adamicAdar.settings = this.plugin.settings;
            const results = this.adamicAdar.calculate(filePath);
            this.render(results);
        });
    }
    renderEmpty() {
        const container = this.containerEl.children[1];
        container.empty();
        container.createEl('div', { text: 'No active file selected.', cls: 'graph-analysis-empty' });
    }
    render(results) {
        const container = this.containerEl.children[1];
        container.empty();
        const dataContainer = container.createDiv({ cls: 'graph-analysis-container' });
        // Header
        const header = dataContainer.createDiv({ cls: 'graph-analysis-header' });
        header.createSpan({ text: 'Atomic Insights', cls: 'graph-analysis-title' });
        // Controls Container
        const controls = header.createDiv({ cls: 'graph-analysis-controls' });
        // Decrease nesting visually by flexbox in css if needed, but for now append buttons to header or controls.
        // Let's put buttons in a container to keep them together.
        // Folder Toggle Button
        // Folder Toggle Button
        const folderBtn = controls.createEl('button', {
            cls: 'graph-analysis-control-btn' + (this.plugin.settings.showFolderNames ? ' is-active' : ''),
            title: this.plugin.settings.showFolderNames ? 'Hide Folder Names' : 'Show Folder Names'
        });
        const iconName = this.plugin.settings.showFolderNames ? 'folder-tree' : 'folder';
        obsidian.setIcon(folderBtn, iconName);
        folderBtn.onclick = () => __awaiter(this, void 0, void 0, function* () {
            var _a;
            this.plugin.settings.showFolderNames = !this.plugin.settings.showFolderNames;
            yield this.plugin.saveSettings();
            this.update((_a = this.currentFilePath) !== null && _a !== void 0 ? _a : undefined);
        });
        // Refresh Button
        const refreshBtn = controls.createEl('button', {
            cls: 'graph-analysis-control-btn',
            title: 'Refresh Analysis'
        });
        obsidian.setIcon(refreshBtn, "refresh-cw");
        refreshBtn.onclick = () => { var _a; return this.update((_a = this.currentFilePath) !== null && _a !== void 0 ? _a : undefined); };
        if (results.length === 0) {
            dataContainer.createDiv({ text: 'No results found.', cls: 'graph-analysis-no-results' });
            return;
        }
        const list = dataContainer.createEl('div', { cls: 'graph-analysis-list' });
        results.slice(0, 50).forEach(res => {
            var _a, _b;
            const item = list.createDiv({ cls: 'graph-analysis-item' });
            item.setAttribute('draggable', 'true');
            // Click to open
            item.addEventListener('click', (e) => {
                var _a;
                // Command/Ctrl click for new tab handled by standard logic if we use openLinkText?
                // Actually openLinkText behavior with modifiers is a bit manual, let's try standard.
                const newLeaf = e.metaKey || e.ctrlKey;
                this.app.workspace.openLinkText(res.path, (_a = this.currentFilePath) !== null && _a !== void 0 ? _a : '', newLeaf);
            });
            // Drag & Drop
            item.addEventListener('dragstart', (e) => {
                if (e.dataTransfer) {
                    // Create wikilink
                    const linkText = `[[${res.path.replace('.md', '')}]]`;
                    e.dataTransfer.setData('text/plain', linkText);
                    e.dataTransfer.effectAllowed = 'copy';
                }
            });
            // Hover Preview
            item.addEventListener('mouseover', (event) => {
                var _a;
                this.app.workspace.trigger('hover-link', {
                    event,
                    source: VIEW_TYPE_ATOMIC_INSIGHTS,
                    hoverParent: this,
                    targetEl: item,
                    linktext: res.path,
                    sourcePath: (_a = this.currentFilePath) !== null && _a !== void 0 ? _a : ''
                });
            });
            // Visuals
            const scorePercent = Math.min(100, Math.round(res.score * 10)); // Arbitrary scale for visibility
            // Name
            const nameEl = item.createDiv({ cls: 'graph-analysis-item-name' });
            const displayName = this.plugin.settings.showFolderNames
                ? res.path.replace('.md', '')
                : (_b = (_a = res.path.split('/').pop()) === null || _a === void 0 ? void 0 : _a.replace('.md', '')) !== null && _b !== void 0 ? _b : res.path;
            nameEl.innerText = displayName;
            // Score Bar
            const barContainer = item.createDiv({ cls: 'graph-analysis-item-bar-container' });
            const bar = barContainer.createDiv({ cls: 'graph-analysis-item-bar' });
            bar.style.width = `${scorePercent}%`;
            bar.title = `Score: ${res.score.toFixed(2)}`;
        });
    }
    onClose() {
        return __awaiter(this, void 0, void 0, function* () {
            // Nothing to cleanup
        });
    }
}

const DEFAULT_SETTINGS = {
    excludedFolders: '',
    showFolderNames: false,
};
class AtomicInsightsSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        const { containerEl } = this;
        containerEl.empty();
        containerEl.createEl('h2', { text: 'Atomic Insights Settings' });
        new obsidian.Setting(containerEl)
            .setName('Show Folder Names')
            .setDesc('Reset the view to apply changes immediately.')
            .addToggle(toggle => toggle
            .setValue(this.plugin.settings.showFolderNames)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.showFolderNames = value;
            yield this.plugin.saveSettings();
        })));
        new obsidian.Setting(containerEl)
            .setName('Excluded Folders')
            .setDesc('One folder path per line. Notes in these folders will be ignored.')
            .addTextArea(text => text
            .setPlaceholder('Templates\nArchive')
            .setValue(this.plugin.settings.excludedFolders)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.excludedFolders = value;
            yield this.plugin.saveSettings();
        })));
    }
}

class AtomicInsightsPlugin extends obsidian.Plugin {
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log('Loading Atomic Insights');
            yield this.loadSettings();
            // Custom Icon: Atomic Network
            // A central core with 3 orbiting nodes connected by lines
            obsidian.addIcon('atomic-insights', `
            <circle cx="50" cy="50" r="14" fill="currentColor" />
            <circle cx="20" cy="20" r="8" fill="currentColor" />
            <circle cx="80" cy="20" r="8" fill="currentColor" />
            <circle cx="50" cy="85" r="8" fill="currentColor" />
            <line x1="50" y1="50" x2="20" y2="20" stroke="currentColor" stroke-width="6" />
            <line x1="50" y1="50" x2="80" y2="20" stroke="currentColor" stroke-width="6" />
            <line x1="50" y1="50" x2="50" y2="85" stroke="currentColor" stroke-width="6" />
        `);
            this.registerView(VIEW_TYPE_ATOMIC_INSIGHTS, (leaf) => new AtomicInsightsView(leaf, this));
            // Ribbon Icon
            this.addRibbonIcon('atomic-insights', 'Atomic Insights', () => {
                this.activateView();
            });
            this.addCommand({
                id: 'open-atomic-insights',
                name: 'Open Atomic Insights View',
                callback: () => {
                    this.activateView();
                },
            });
            this.addSettingTab(new AtomicInsightsSettingTab(this.app, this));
        });
    }
    onunload() {
        console.log('Unloading Atomic Insights');
    }
    loadSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
        });
    }
    saveSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.saveData(this.settings);
            // Trigger generic event or let view handle it?
            // For now, simpler is better. User might need to reopen/refresh view if settings change, 
            // or we can add a method to notify view later.
        });
    }
    activateView() {
        return __awaiter(this, void 0, void 0, function* () {
            const { workspace } = this.app;
            let leaf = null;
            const leaves = workspace.getLeavesOfType(VIEW_TYPE_ATOMIC_INSIGHTS);
            if (leaves.length > 0) {
                leaf = leaves[0];
            }
            else {
                leaf = workspace.getRightLeaf(false);
                if (leaf) {
                    yield leaf.setViewState({
                        type: VIEW_TYPE_ATOMIC_INSIGHTS,
                        active: true,
                    });
                }
            }
            if (leaf) {
                workspace.revealLeaf(leaf);
            }
        });
    }
}

module.exports = AtomicInsightsPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsInNyYy9BZGFtaWNBZGFyLnRzIiwic3JjL0FuYWx5c2lzVmlldy50cyIsInNyYy9TZXR0aW5ncy50cyIsInNyYy9tYWluLnRzIl0sInNvdXJjZXNDb250ZW50IjpudWxsLCJuYW1lcyI6WyJJdGVtVmlldyIsInNldEljb24iLCJQbHVnaW5TZXR0aW5nVGFiIiwiU2V0dGluZyIsIlBsdWdpbiIsImFkZEljb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF1REE7QUFDTyxTQUFTLFNBQVMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUU7QUFDN0QsSUFBSSxTQUFTLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxPQUFPLEtBQUssWUFBWSxDQUFDLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLFVBQVUsT0FBTyxFQUFFLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7QUFDaEgsSUFBSSxPQUFPLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUMsRUFBRSxVQUFVLE9BQU8sRUFBRSxNQUFNLEVBQUU7QUFDL0QsUUFBUSxTQUFTLFNBQVMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO0FBQ25HLFFBQVEsU0FBUyxRQUFRLENBQUMsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsS0FB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
